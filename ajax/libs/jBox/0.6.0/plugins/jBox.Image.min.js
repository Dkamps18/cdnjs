jQuery(document).ready(function(){new jBox.plugin("Image",{src:"href",gallery:"data-jbox-image",imageLabel:"title",imageFade:360,imageSize:"contain",imageCounter:!1,imageCounterSeparator:"/",downloadButton:!1,downloadButtonText:null,downloadButtonUrl:null,target:window,attach:"[data-jbox-image]",fixed:!0,blockScroll:!0,closeOnEsc:!0,closeOnClick:"button",closeButton:!0,overlay:!0,animation:"zoomIn",preventDefault:!0,width:"100%",height:"100%",adjustDistance:{top:40,right:5,bottom:40,left:5},_onInit:function(){this.images=this.currentImage={},this.imageZIndex=1,this.initImage=function(e){if(!(e=jQuery(e)).data("jBox-image-gallery")){var i=e.attr(this.options.gallery)||"default";!this.images[i]&&(this.images[i]=[]),this.images[i].push({src:e.attr(this.options.src),label:e.attr(this.options.imageLabel)||"",downloadUrl:this.options.downloadButtonUrl&&e.attr(this.options.downloadButtonUrl)?e.attr(this.options.downloadButtonUrl):null}),"title"==this.options.imageLabel&&e.removeAttr("title"),e.data("jBox-image-gallery",i),e.data("jBox-image-id",this.images[i].length-1)}}.bind(this),this.attachedElements&&jQuery.each(this.attachedElements,function(e,i){this.initImage(i)}.bind(this));var n=function(e,i,t,a,n){if(!jQuery("#jBox-image-"+e+"-"+i).length){var o=jQuery("<div/>",{id:"jBox-image-"+e+"-"+i,class:"jBox-image-container"+(n?" jBox-image-not-found":"")+(a||t?"":" jBox-image-"+e+"-current")}).css({backgroundImage:n?"":'url("'+this.images[e][i].src+'")',backgroundSize:this.options.imageSize,opacity:a?1:0,zIndex:t?0:this.imageZIndex++}).appendTo(this.content);jQuery("<div/>",{id:"jBox-image-label-"+e+"-"+i,class:"jBox-image-label"+(a?" active":"")}).html(this.images[e][i].label).click(function(){$(this).toggleClass("expanded")}).appendTo(this.imageLabel),!a&&!t&&o.animate({opacity:1},this.options.imageFade)}}.bind(this);this.downloadImage=function(e){var i=document.createElement("a");i.href=e,i.setAttribute("download",e.substring(e.lastIndexOf("/")+1)),document.body.appendChild(i),i.click()};var o=function(e,i){jQuery(".jBox-image-label.active").removeClass("active expanded"),jQuery("#jBox-image-label-"+e+"-"+i).addClass("active")};this.showImage=function(e){if("open"!=e){var i=this.currentImage.gallery;t=(t=this.currentImage.id+(1*("prev"==e)?-1:1))>this.images[i].length-1?0:t<0?this.images[i].length-1:t}else{i=this.source.data("jBox-image-gallery");var t=this.source.data("jBox-image-id");jQuery(".jBox-image-pointer-prev, .jBox-image-pointer-next").css({display:1<this.images[i].length?"block":"none"})}if(jQuery(".jBox-image-"+i+"-current").length&&jQuery(".jBox-image-"+i+"-current").removeClass("jBox-image-"+i+"-current").animate({opacity:0},"open"==e?0:this.options.imageFade),this.currentImage={gallery:i,id:t},jQuery("#jBox-image-"+i+"-"+t).length?(jQuery("#jBox-image-"+i+"-"+t).addClass("jBox-image-"+i+"-current").css({zIndex:this.imageZIndex++,opacity:0}).animate({opacity:1},"open"==e?0:this.options.imageFade),o(i,t)):(this.wrapper.addClass("jBox-image-loading"),jQuery('<img src="'+this.images[i][t].src+'"/>').each(function(){var e=new Image;e.onload=function(){n(i,t,!1),o(i,t),this.wrapper.removeClass("jBox-image-loading")}.bind(this),e.onerror=function(){n(i,t,!1,null,!0),o(i,t),this.wrapper.removeClass("jBox-image-loading")}.bind(this),e.src=this.images[i][t].src}.bind(this))),this.imageCounter&&(1<this.images[i].length?(this.wrapper.addClass("jBox-image-has-counter"),this.imageCounter.find(".jBox-image-counter-all").html(this.images[i].length),this.imageCounter.find(".jBox-image-counter-current").html(t+1)):this.wrapper.removeClass("jBox-image-has-counter")),this.images[i].length-1){var a=t+1;a=a>this.images[i].length-1?0:a<0?this.images[i].length-1:a,!jQuery("#jBox-image-"+i+"-"+a).length&&jQuery('<img src="'+this.images[i][a].src+'"/>').each(function(){var e=new Image;e.onload=function(){n(i,a,!0)}.bind(this),e.onerror=function(){n(i,a,!0,null,!0)}.bind(this),e.src=this.images[i][a].src}.bind(this))}}},_onAttach:function(e){this.initImage&&this.initImage(e)},_onCreated:function(){this.imageLabel=jQuery("<div/>",{class:"jBox-image-label-container"}).appendTo(this.wrapper),this.imageLabel.append(jQuery("<div/>",{class:"jBox-image-pointer-prev",click:function(){this.showImage("prev")}.bind(this)})).append(jQuery("<div/>",{class:"jBox-image-pointer-next",click:function(){this.showImage("next")}.bind(this)})),this.options.downloadButton&&(this.downloadButton=jQuery("<div/>",{class:"jBox-image-download-button-wrapper"}).appendTo(this.wrapper).append(this.options.downloadButtonText?jQuery("<div/>",{class:"jBox-image-download-button-text"}).html(this.options.downloadButtonText):null).append(jQuery("<div/>",{class:"jBox-image-download-button-icon"})).on("click touchdown",function(){if(this.images[this.currentImage.gallery][this.currentImage.id].downloadUrl)var e=this.images[this.currentImage.gallery][this.currentImage.id].downloadUrl;else e=this.wrapper.find(".jBox-image-default-current")[0].style.backgroundImage.slice(4,-1).replace(/["']/g,"");this.downloadImage(e)}.bind(this))),this.options.imageCounter&&(this.imageCounter=jQuery("<div/>",{class:"jBox-image-counter-container"}).appendTo(this.wrapper),this.imageCounter.append(jQuery("<span/>",{class:"jBox-image-counter-current"})).append(jQuery("<span/>").html(this.options.imageCounterSeparator)).append(jQuery("<span/>",{class:"jBox-image-counter-all"})))},_onOpen:function(){jQuery(document).on("keyup.jBox-Image-"+this.id,function(e){37==e.keyCode&&this.showImage("prev"),39==e.keyCode&&this.showImage("next")}.bind(this)),this.showImage("open")},_onClose:function(){jQuery(document).off("keyup.jBox-Image-"+this.id)},_onCloseComplete:function(){this.wrapper.find(".jBox-image-container").css("opacity",0)}})});